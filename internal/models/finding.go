package models

import (
    "strings"
    "time"

)

type Finding struct {
    ID          int       `json:"id"`
    ReportID    int       `json:"report_id"`
    Name        string    `json:"name"`
    Status      string    `json:"status"`
    Severity    string    `json:"severity"`
    Weakness    string    `json:"weakness"`
    Description string    `json:"description"`
    Impact      string    `json:"impact"`
    ImageURLs   string    `json:"image_url"` // Internal field for database storage
    ImageURLsArray []string `json:"image_urls"`
    Link        string    `json:"link"`
    Recommend   string    `json:"recommend"`
    Author      string    `json:"author"`
    CreatedAt   time.Time `json:"created_at"`
}

type FindingResponse struct {
    ID          int       `json:"id"`
    ReportID    int       `json:"report_id"`
    Name        string    `json:"name"`
    Status      string    `json:"status"`
    Severity    string    `json:"severity"`
    Weakness    string    `json:"weakness"`
    Description string    `json:"description"`
    Impact      string    `json:"impact"`
    ImageURLs   []string  `json:"image_urls"`
    Link        string    `json:"link"`
    Recommend   string    `json:"recommend"`
    Author      string    `json:"author"`
    CreatedAt   string    `json:"created_at"`
}

func (f *Finding) ToResponse() FindingResponse {
    return FindingResponse{
        ID:          f.ID,
        ReportID:    f.ReportID,
        Name:        f.Name,
        Status:      f.Status,
        Severity:    f.Severity,
        Weakness:    f.Weakness,
        Description: f.Description,
        Impact:      f.Impact,
        ImageURLs:   strings.Split(f.ImageURLs, ","),
        Link:        f.Link,
        Recommend:   f.Recommend,
        Author:      f.Author,
        CreatedAt:   f.CreatedAt.Format("2006-01-02"),
    }
}
