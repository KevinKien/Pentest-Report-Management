function addreport(btn) {
    var url = window.location.pathname;
    var match = url.match(/\/project\/(\d+)/);
    var projectId = match[1];
    reportname = document.getElementById('reportname').value;
    fetch("/api/v1/report", {
      method: "POST",
      mode: 'cors',
      body: JSON.stringify({
        "project_id": projectId,
        "name": reportname
      }),
      headers: {
        "Content-type": "application/json",
        "Authorization": "Bearer " + localStorage.getItem("token")
      }
    }).then(async (response) => {
      if (response.status === 201) {
        window.location.replace("/project/"+projectId);
      } else if (response.status === 401) {
        window.location.replace("/login");
      }
    }).catch((error) => {
      window.location.replace("/project/"+projectId);
    });
}


async function project_one() {
    var url = window.location.pathname;
    var match = url.match(/\/project\/(\d+)/);
    var projectId = match[1];
    fetch("/api/v1/project/" + projectId, {
        method: "GET",
        mode: 'cors',
        headers: {
            "Content-type": "application/json",
            "Authorization": "Bearer " + localStorage.getItem("token")
        }
    }).then(async (response) => {
        // get json response here
        let data = await response.json();
        if (response.status == 200) {
            document.getElementById("projectname").innerText = data['name'];
            document.getElementById("projectdes").innerText = data['description'];
            document.getElementById("projectcreated_at").innerText = data['created_at'];
            document.getElementById("projectreport").innerText = data['total_reports'];
            var table = $("#kt_profile_overview_table").DataTable();
            table.clear(); // Clear existing rows

            for (let r of data['reports']) {
                let statusClass = r['status'] === 'Open' ? 'badge-light-info' : 'badge-light-success';
                table.row.add([
                    `<div class="d-flex align-items-center">
                        <div class="d-flex flex-column justify-content-center">
                            <a href="/report/${r['id']}" class="fs-6 text-gray-800 text-hover-primary">${r['name']}</a>
                        </div>
                    </div>`,
                    r['date'],
                    r['author'],
                    `<span class="badge ${statusClass} fw-bold px-4 py-3">${r['status']}</span>`,
                    `<div class="text-end"><a href="/report/${r['id']}" class="btn btn-light btn-sm">View</a></div>`
                ]).draw(false);
            }

            for (let i = 0; i < data['report_authors'].length && i < 10; i++) {
                let u = data['report_authors'][i];
                let initial = u.charAt(0).toUpperCase();
                document.getElementById("projectall").innerHTML += `
                <div class="symbol symbol-35px symbol-circle" data-bs-toggle="tooltip" data-bs-original-title="`+ u +`" data-kt-initialized="1">
                    <span class="symbol-label bg-warning text-inverse-warning fw-bold">`+ initial +`</span>
                </div>
                `;
            }
        } else {
            window.location.replace("/login");
        }
    });
};

    
project_one();